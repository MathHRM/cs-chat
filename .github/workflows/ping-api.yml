name: Ping API

on:
  workflow_dispatch:
  push:
    branches:
      - main
  schedule:
    # NOTE: GitHub Actions cron is hour-based; "*/14" runs at minutes 0,14,28,42,56.
    - cron: '*/14 * * * *'

concurrency:
  group: ping-api
  cancel-in-progress: true

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Ping
        env:
          API_URL: ${{ secrets.API_URL }}
          API_TOKEN: ${{ secrets.API_TOKEN }}
        run: |
          set -euo pipefail

          if [ -z "${API_URL:-}" ]; then
            echo "Missing secrets.API_URL" >&2
            exit 1
          fi

          auth_args=()
          if [ -n "${API_TOKEN:-}" ]; then
            auth_args+=( -H "Authorization: Bearer ${API_TOKEN}" )
          fi

          curl --fail-with-body --silent --show-error \
            --connect-timeout 10 --max-time 30 \
            --retry 3 --retry-delay 2 --retry-all-errors \
            "${auth_args[@]}" \
            "$API_URL/ping"
